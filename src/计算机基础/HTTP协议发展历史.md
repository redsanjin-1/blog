# 1.什么是HTTP

**HTTP(HyperText Transfer Protocol):** 超文本传输协议。是互联网上应用最广泛的一种网络协议。所有www文件都必须遵守的一个标准，是以 ASCII 码传输，建立在 TCP/IP 协议之上的应用层规范。简单点说就是一种固定的通讯规则。

![dfa643a82212.png](../images/HTTP2-graphic.png)

# 2.HTTP/0.9版本

这是最早定稿的HTTP版本，这个版本中它的内容非常地简单。

- 首先它只有一个命令GET。对应到现在的GET请求和POST请求，这些叫做HTTP的命令或者方法。

- 它没有HEADER等描述数据的信息。因为这个时候的请求非常简单，它需要达到的目的也非常简单，没有那么多数据格式。

- 服务器发送完内容之后（只能发送HTML格式的字符串），就关闭TCP连接（短连接）。这里需要注意一点，这里的TCP连接和http请求是不一样的。http请求和TCP连接不是一个概念。一个http请求通过TCP连接发送，而一个TCP连接里面可以发送很多个http请求（HTTP/0.9不能这么做，但是HTTP/1.1可以这么做，而且在HTTP/2这方面会更大程度地优化，来提高HTTP协议传输的效率以及服务器的性能）所以一个TCP连接对应的是多个http请求，一个http请求肯定是在某一个TCP连接里面进行发送的，

# 3.HTTP/1.0版本

这个版本和现在普遍使用的HTTP/1.1差不多，在HTTP/0.9版本基础上进行了改进。

- 任何格式的内容都可以发送，这使得互联网不仅可以传输文字，还能传输图像、视频、二进制文件。

- 增加了很多命令。比如：POST、HEADER这些命令。

- 增加了status code和header相关的内容。status code是用来描述服务器端处理某一个请求之后的状态的；header主要包含：请求和发送数据的描述以及对这部分数据进行操作的方法。

- 增加了多字符集支持、多部分发送、权限、缓存等相关的内容。这些内容有利于更好地使用http请求去实现WEB服务。

# 4.HTTP/1.1版本

这个版本是在HTTP/1.0的基础上增加了一些功能来优化网络连接的过程。

- 在这个版本支持了持久长连接（connection：keep-alive）。在HTTP/1.0版本里面，一个http请求要发送就要先在客户端和服务器端之间创建一个TCP连接，创建完这个TCP连接之后，等服务器端返回完数据之后，这个TCP连接就关闭了。这个成本是相对比较高的，因为在建立一个TCP连接的过程中要进行http的三次握手，这一部分是通过TCP来完成的，在创建这个连接的过程中消耗是比较高的，延迟也会比较高。所以如果在建立完一个连接之后，它可以不关闭，之后新的http请求就可以一直在这个连接里面进行数据发送的话，它的性能和效率肯定会提升很多，HTTP/1.1已经实现了这个功能。

- 增加了pipeline。可以在同一个TCP连接里面发送多个http请求（同一个域名最多6个连接），就是上面说的那样。但是在HTTP/1.1里面，虽然是可以在同一个TCP连接里面发送多个http请求，但是服务器端对于进来的请求，是要按照顺序进行数据返回的。因此，如果前一个请求等待时间非常长，而后一个请求处理得比较快。这个时候后一个请求不能先发送，而是要等第一个请求数据全部发送完成之后，才能进行发送，即是串行的。等待的这部分时间就体现出了与并行传输性能之间的差距。而这个在HTTP/2里面得到了优化。

- 增加了HTTP的头host和range等其他一些命令。range字段允许只请求资源的某个部分，即返回码是206（Partial Content）,充分利用带宽和连接（比如文件断点续传）。另外比较重要的就是host，有了host之后就可以在同一台服务器(物理服务器)上同时跑多个web服务。比如说一个Node.js的web服务，一个Java的web服务。通过host这个字段来表示两个服务都是请求到同一个物理服务器上，但是我要请求的是里面哪一个软件服务，Node.js还是Java？这就是通过host来进行判断的。这个host头增加的好处就是，在同一个物理服务器或者同一个集群里面可以部署很多不同的web服务来，提高了物理服务器的使用效率。

# 5.HTTP/2.0版本

虽然现在还没有普及，但是毫无疑问是未来的趋势。

- 所有数据都是以二进制进行传输的。在HTTP/1.1里面大部分的数据传输是通过字符串（头信息字符串，数据体可以是字符串或者二进制数据流），所以数据的分片方式是不太一样的。在HTTP/2里面所有的数据都是以帧进行传输的。

- 正是因为有了这个好处，同一个连接里面发送多个请求时（多路复用），服务器端不再需要按照顺序来返回处理后的数据了。而是可以在返回第一个请求里面数据的时候，同时返回第二个请求里面的数据。这样的并行传输能够更大限度地提高web应用的传输效率。

- 新增头信息压缩以及推送等功能，提高了传输效率。HTTP/2其实主要就是改善了HTTP/1.1里面造成性能低下的一些问题。

**第一个头信息的压缩。**在HTTP1.0中，我们使用文本的形式传输header，在header中携带cookie的话，每次都需要重复传输几百到几千的字节，这着实是一笔不小的开销。
在HTTP2.0中，我们使用了HPACK（HTTP2头部压缩算法）压缩格式对传输的header进行编码，减少了header的大小。并在两端维护了索引表，用于记录出现过的header，后面在传输过程中就可以传输已经记录过的header的键名，对端收到数据后就可以通过键名找到对应的值。

**第二个是推送的功能。**指的是HTTP/2之前，只能由客户端发送数据，服务器端返回数据。客户端是主动方，服务器端永远是被动方。在HTTP/2里面有了”推送”的概念，也就是说服务器端可以主动向客户端发起一些数据传输。（被动的，只有请求后，才能做server push，websocket是主动的，客户端服务端都可以主动推送）

# 6.HTTP/3.0版本

基于QUIC协议，它是基于udp实现的，

- 减少了往返次数（RTT）缩短建立时间（tcp握手，tls握手时间）

- 独立的数据流避免TCP队头堵塞（丢包后会堵塞）

- 使用FEC（前向纠错）恢复丢失的包，以减少超时重传

- 连接迁移每个连接过程都有一组连接标识符，或称连接ID，它可以在IP地址和网络接口迁移的情况下得到支持（例如从4G切换到wifi后仍然可以使用这个连接）

# 7.参考

- [HTTP协议1.x，2.0， 3.0版本对比分析](https://www.bilibili.com/video/BV1s34y1S7bT)

- [QUIC 协议：HTTP/3 下一代互联网传输协议](https://www.bilibili.com/video/BV1fr4y1F7BD)

